<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educational Digital Signature App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app-container">
        <header>
            <h1>Permission Slip Manager</h1>
            <p class="subtitle">Educational Digital Signature Project (RSA Hash & Sign)</p>
        </header>

        <div id="messageArea" class="message-area hidden"></div>

        <div id="roleSelectionView" class="view">
            <h2>Select Your Role</h2>
            <button id="showAdminLoginBtn">Access Admin Panel</button>
            <button id="showParentViewBtn">Access Parent Portal</button>
        </div>

        <div id="adminLoginView" class="view hidden">
            <div class="view-header">
                <h2>Admin Login</h2>
                <button class="back-to-role-btn">&larr; Back to Role Selection</button>
            </div>
            <div class="card">
                <h3>Please Log In</h3>
                <form id="adminLoginForm">
                    <label for="adminEmail">Email:</label>
                    <input type="email" id="adminEmail" name="email" placeholder="Admin Email" required>
                    <label for="adminPassword">Password:</label>
                    <input type="password" id="adminPassword" name="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                    <p id="loginErrorMessage" class="error-message"></p>
                </form>
            </div>
        </div>

        <div id="adminView" class.view="view hidden">
            <div class="view-header">
                <h2>Admin Panel</h2>
                <button id="adminLogoutBtn" class="danger-btn">Logout</button>
            </div>
            <div class="card">
                <h3>Create New Permission Slip</h3>
                <form id="createFormAdmin">
                    <label for="formTitle">Form Title:</label>
                    <input type="text" id="formTitle" name="title" placeholder="e.g., Zoo Field Trip" required>
                    
                    <label for="formDescription">Description/Details:</label>
                    <textarea id="formDescription" name="description" rows="3" placeholder="Details about the event..." required></textarea>
                    
                    <label for="studentName">Student's Full Name:</label>
                    <input type="text" id="studentName" name="studentName" placeholder="e.g., Jane Doe" required>
                    
                    <label for="parentEmail">Parent's Email:</label>
                    <input type="email" id="parentEmail" name="parentEmail" placeholder="e.g., parent@example.com" required>
                    
                    <button type="submit">Create & Send Form</button>
                    <div id="createFormErrorMessage" class="error-message"></div>
                </form>
            </div>
            <div class="card">
                <h3>Manage Forms</h3>
                <div id="adminFormsList">
                    <p>Loading forms...</p>
                </div>
            </div>
        </div>

        <div id="parentView" class="view hidden">
            <div class="view-header">
                <h2>Parent Portal</h2>
                <button class="back-to-role-btn">&larr; Back to Role Selection</button>
            </div>
            <div class="card">
                <form id="findFormsParent">
                    <label for="parentEmailLookup">Enter Your Email to View Forms:</label>
                    <input type="email" id="parentEmailLookup" name="parentEmailLookup" placeholder="Your Email Address" required>
                    <button type="submit">Find My Forms</button>
                </form>
            </div>
            <div id="parentFormsArea" class="hidden">
                <h3>Your Forms</h3>
                <div id="parentFormsList">
                     <p>No forms found for this email or all forms are signed.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="signingModal" class="modal">
        <div class="modal-content">
            <span id="closeSigningModal" class="close-button">&times;</span>
            <h3 id="signingModalTitle">Sign Permission Slip</h3>
            <div id="signingModalFormDetails" class="form-details">
                <p><strong>Title:</strong> <span id="modalFormTitle"></span></p>
                <p><strong>Description:</strong> <span id="modalFormDescription"></span></p>
                <p><strong>Student:</strong> <span id="modalFormStudentName"></span></p>
            </div>
            <form id="signatureForm">
                <input type="hidden" id="signingFormId">
                <label for="typedSignature">Type Your Full Name (as on record):</label>
                <input type="text" id="typedSignature" name="typedSignature" placeholder="Your Full Name" required>
                
                <label>Draw Your Signature Below:</label>
                <div class="signature-pad-container">
                    <canvas id="signature-pad"></canvas> </div>
                <button type="button" id="clearSignatureBtn" class="secondary-btn">Clear Signature</button>
                
                <div class="consent-checkbox">
                    <input type="checkbox" id="signatureConsent" required>
                    <label for="signatureConsent">I understand I am digitally signing this document.</label>
                </div>
                <button type="submit" id="submitSignatureBtn">Submit Digital Signature</button>
                <p id="signingErrorMessage" class="error-message"></p>
            </form>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="script.js"></script>
</body>
</html>